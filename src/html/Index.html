<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tableau Blueprint ワークショップ</title>
  <?!= include('Styles'); ?>
</head>
<body>
  <!-- ローディング表示 -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p>読み込み中...</p>
  </div>

  <!-- メインコンテナ -->
  <div id="app" class="app-container" style="display: none;">
    <!-- ヘッダー -->
    <header class="header">
      <h1>Tableau Blueprint ワークショップ</h1>
      <div class="user-info">
        <span id="userEmail"><?= userEmail ?></span>
      </div>
    </header>

    <div class="main-layout">
      <!-- サイドナビゲーション -->
      <nav class="sidebar">
        <div class="nav-section">
          <h3>プロジェクト</h3>
          <button onclick="showView('home')" class="nav-button">ホーム</button>
          <button onclick="showView('projects')" class="nav-button">プロジェクト一覧</button>
        </div>

        <div class="nav-section" id="projectNav" style="display: none;">
          <h3>MVPモジュール</h3>
          <button onclick="showView('vision')" class="nav-button">1. 北極星ビジョン</button>
          <button onclick="showView('usecases')" class="nav-button">2. ユースケース選定</button>
          <button onclick="showView('organization')" class="nav-button">4. 体制・RACI</button>
          <button onclick="showView('value')" class="nav-button">7. 価値トラッキング</button>
        </div>

        <div class="nav-section" id="projectActions" style="display: none;">
          <h3>アクション</h3>
          <button onclick="generateProposal()" class="nav-button nav-button-primary">稟議書案を生成</button>
          <button onclick="confirmProject()" class="nav-button">プロジェクトを確定</button>
        </div>

        <div class="nav-section">
          <h3>管理</h3>
          <button onclick="initializeSheets()" class="nav-button nav-button-secondary">シート初期化</button>
        </div>
      </nav>

      <!-- メインコンテンツ -->
      <main class="content">
        <!-- ホーム画面 -->
        <div id="view-home" class="view">
          <h2>ようこそ</h2>
          <p>営業が顧客と画面を見ながら、合意形成から稟議書案までを一気通貫で進められるワークショップ型アプリです。</p>

          <div class="card-grid">
            <div class="card" onclick="showView('projects')">
              <h3>📁 プロジェクト管理</h3>
              <p>新規プロジェクトの作成や既存プロジェクトの管理</p>
            </div>

            <div class="card" onclick="showView('vision')">
              <h3>⭐ 北極星を決める</h3>
              <p>ビジョン策定と意思決定ルールの明確化</p>
            </div>

            <div class="card" onclick="showView('usecases')">
              <h3>🎯 90日計画を作る</h3>
              <p>戦略的ユースケースの選定と始動計画</p>
            </div>

            <div class="card" onclick="showView('organization')">
              <h3>👥 体制と責任を確定</h3>
              <p>3本柱組織とRACIマトリクスの設計</p>
            </div>

            <div class="card" onclick="showView('value')">
              <h3>📊 成果を稟議に変換</h3>
              <p>価値トラッキングと証跡管理</p>
            </div>
          </div>
        </div>

        <!-- プロジェクト一覧 -->
        <div id="view-projects" class="view" style="display: none;">
          <h2>プロジェクト一覧</h2>

          <div class="toolbar">
            <button onclick="showNewProjectModal()" class="btn btn-primary">新規プロジェクト作成</button>
          </div>

          <div id="projectsList" class="projects-list">
            <!-- プロジェクト一覧が動的に表示される -->
          </div>
        </div>

        <!-- Module 1: ビジョン -->
        <div id="view-vision" class="view" style="display: none;">
          <h2>Module 1: 北極星ビジョン・メーカー</h2>
          <p>プロジェクトの北極星となるビジョンを策定します。</p>

          <div class="form-group">
            <label>ビジョン本文 *</label>
            <textarea id="visionText" rows="5" placeholder="この取り組みで実現したい理想の姿を記述してください"></textarea>
          </div>

          <div class="form-group">
            <label>意思決定ルール</label>
            <textarea id="decisionRules" rows="3" placeholder="判断に迷ったときの基準を記述してください"></textarea>
          </div>

          <div class="form-group">
            <label>成功指標</label>
            <textarea id="successMetrics" rows="3" placeholder="どうなれば成功と言えるか、KPIを記述してください"></textarea>
          </div>

          <div class="form-group">
            <label>備考</label>
            <textarea id="visionNotes" rows="2" placeholder="補足情報があれば記述してください"></textarea>
          </div>

          <div class="toolbar">
            <button onclick="saveVision()" class="btn btn-primary">保存</button>
            <span id="visionSaveStatus" class="save-status"></span>
          </div>
        </div>

        <!-- Module 2: ユースケース -->
        <div id="view-usecases" class="view" style="display: none;">
          <h2>Module 2: 戦略的ユースケース選定 + 90日計画</h2>
          <p>始動段階（1〜3ヶ月）で取り組む戦略的ユースケースを選定します。</p>

          <div class="toolbar">
            <button onclick="showNewUsecaseModal()" class="btn btn-primary">ユースケースを追加</button>
          </div>

          <div id="usecasesList" class="usecases-list">
            <!-- ユースケース一覧が動的に表示される -->
          </div>
        </div>

        <!-- Module 4: 体制・RACI -->
        <div id="view-organization" class="view" style="display: none;">
          <h2>Module 4: 3本柱組織 + RACI設計</h2>
          <p>Tableau Blueprint の3本柱組織モデルに基づき、体制と責任を明確化します。</p>

          <div class="info-box">
            <h4>3本柱組織モデル</h4>
            <ul>
              <li><strong>CoE (Center of Excellence)</strong>: 推進の中核、ベストプラクティス策定</li>
              <li><strong>ビジネスデータネットワーク</strong>: 現場のデータ活用推進者</li>
              <li><strong>IT</strong>: 技術基盤とガバナンスの管理</li>
            </ul>
          </div>

          <div class="toolbar">
            <button onclick="addRACIRow()" class="btn btn-primary">行を追加</button>
            <button onclick="saveRACIEntries()" class="btn btn-success">保存</button>
            <span id="raciSaveStatus" class="save-status"></span>
          </div>

          <table id="raciTable" class="raci-table">
            <thead>
              <tr>
                <th>3本柱区分</th>
                <th>タスク</th>
                <th>担当者</th>
                <th>RACI</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="raciTableBody">
              <!-- RACI行が動的に表示される -->
            </tbody>
          </table>
        </div>

        <!-- Module 7: 価値トラッキング -->
        <div id="view-value" class="view" style="display: none;">
          <h2>Module 7: 価値実現トラッカー</h2>
          <p>ユースケースごとの成果と証跡を管理します。</p>

          <div id="valuesList" class="values-list">
            <!-- 価値トラッキングフォームが動的に表示される -->
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- モーダル: 新規プロジェクト作成 -->
  <div id="newProjectModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('newProjectModal')">&times;</span>
      <h3>新規プロジェクト作成</h3>

      <div class="form-group">
        <label>顧客名 *</label>
        <input type="text" id="newProjectCustomerName" placeholder="株式会社○○">
      </div>

      <div class="modal-actions">
        <button onclick="createProject()" class="btn btn-primary">作成</button>
        <button onclick="closeModal('newProjectModal')" class="btn btn-secondary">キャンセル</button>
      </div>
    </div>
  </div>

  <!-- モーダル: 新規ユースケース追加 -->
  <div id="newUsecaseModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('newUsecaseModal')">&times;</span>
      <h3>ユースケースを追加</h3>

      <div class="form-group">
        <label>課題 *</label>
        <textarea id="newUsecaseChallenge" rows="2" placeholder="解決したい課題を記述"></textarea>
      </div>

      <div class="form-group">
        <label>狙い *</label>
        <textarea id="newUsecaseGoal" rows="2" placeholder="このユースケースで達成したいこと"></textarea>
      </div>

      <div class="form-group">
        <label>想定効果</label>
        <textarea id="newUsecaseImpact" rows="2" placeholder="期待される成果"></textarea>
      </div>

      <div class="form-group">
        <label>90日ゴール</label>
        <textarea id="newUsecaseNinetyDayGoal" rows="2" placeholder="始動段階（1〜3ヶ月）で達成する目標"></textarea>
      </div>

      <div class="form-group">
        <label>優先度スコア (1-100)</label>
        <input type="number" id="newUsecaseScore" min="1" max="100" value="50">
      </div>

      <div class="modal-actions">
        <button onclick="addUsecase()" class="btn btn-primary">追加</button>
        <button onclick="closeModal('newUsecaseModal')" class="btn btn-secondary">キャンセル</button>
      </div>
    </div>
  </div>

  <?!= include('Scripts'); ?>
</body>
</html>
